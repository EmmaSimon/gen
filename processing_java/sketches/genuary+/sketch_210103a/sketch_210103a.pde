import nice.palettes.*;

String arecibo = "00000010101010000000000001010000010100000001001000100010001001011001010101010101010100100100000000000000000000000000000000000001100000000000000000001101000000000000000000011010000000000000000001010100000000000000000011111000000000000000000000000000000001100001110001100001100010000000000000110010000110100011000110000110101111101111101111101111100000000000000000000000000100000000000000000100000000000000000000000000001000000000000000001111110000000000000111110000000000000000000000011000011000011100011000100000001000000000100001101000011000111001101011111011111011111011111000000000000000000000000001000000110000000001000000000001100000000000000010000011000000000011111100000110000001111100000000001100000000000001000000001000000001000001000000110000000100000001100001100000010000000000110001000011000000000000000110011000000000000011000100001100000000011000011000000100000001000000100000000100000100000001100000000100010000000011000000001000100000000010000000100000100000001000000010000000100000000000011000000000110000000011000000000100011101011000000000001000000010000000000000010000011111000000000000100001011101001011011000000100111001001111111011100001110000011011100000000010100000111011001000000101000001111110010000001010000011000000100000110110000000000000000000000000000000000011100000100000000000000111010100010101010101001110000000001010101000000000000000010100000000000000111110000000000000000111111111000000000000111000000011100000000011000000000001100000001101000000000101100000110011000000011001100001000101000001010001000010001001000100100010000000010001010001000000000000100001000010000000000001000000000100000000000000100101000000000001111001111101001111000";
boolean[][] areciboGrid = new boolean[73][23];
int gridSize = 10;

ColorPalette palette;
long seed = (long) random(99999);

void setup() {
  size(230,730);
  palette = new ColorPalette(this);
  palette.getPalette();
  smooth(8);
  noFill();
  noStroke();
  noiseSeed(seed);
  noLoop();
  for (int i = 0; i < arecibo.length(); i++) {
    int row = floor(i/23);
    int col = i%23;
    areciboGrid[row][col] = arecibo.charAt(i) == '1';
  }
}

void draw() {
  background(palette.colors[0]);
  pushMatrix();
  
  int rowCount = 0;
  int bitCount = 0;
  for (boolean[] row : areciboGrid) {
    for (boolean bit : row) {
      int colorIndex = floor(rowCount/25) + 1;
      float blend = ((float) rowCount/25.0) - (colorIndex - 1);
      stroke(
        lerpColor(
          palette.colors[colorIndex],
          palette.colors[colorIndex+1],
          blend
        )
      );
      float skew = lerp(0, 3, noise(bitCount, rowCount));
      if (bit) {
        //line((gridSize/2) + skew , 0, gridSize/2 - skew, gridSize);
        //circle(gridSize/2, gridSize/2, gridSize);
        for (int p = 0; p < 250; p++) {
          point((gridSize/2) + skew * randomGaussian(), (gridSize/2) + skew * randomGaussian());
        }
      } else {
        //line(0, (gridSize/2) - skew, gridSize, (gridSize/2) + skew);
        //line((gridSize/2) + skew , 0, gridSize/2 - skew, gridSize);
      }
      translate(gridSize, 0);
      bitCount++;
    }
    rowCount++;
    translate(-gridSize * 23, gridSize);
  }
  popMatrix();
}

void keyPressed() {
  if (key == 's') {
    background(palette.colors[4]);
    seed = (int) random(99999);
    noiseSeed(seed);
    redraw();
  } else if (key == 'p') {
    palette.getPalette();
    background(palette.colors[4]);
    redraw();
  } else if (key == 'i') {
    save(String.format("arecibo-%s.png", millis()));
  }
}
